<!DOCTYPE html>
<html lang="ko" xmlns:th="http://www.thymeleaf.org">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>AI ì¶”ì²œ ê²°ê³¼</title>
  <link rel="stylesheet" href="/css/onboarding-result.css">
  <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+KR:wght@300;400;500;700;900&display=swap" rel="stylesheet">
  <script src="/js/onboarding-result.js" defer></script>
</head>
<body>
<!-- ë°°ê²½ ì¥ì‹ ìš”ì†Œë“¤ -->
<div class="bg-decoration"></div>
<div class="bg-decoration"></div>
<div class="bg-decoration"></div>

<main class="container">
  <div class="content-wrapper">
    <!-- í—¤ë” ì„¹ì…˜ -->
    <div class="header-section">
      <div class="success-badge">
        <span class="success-icon">ğŸ‰</span>
        <span class="success-text">ì™„ë£Œ!</span>
      </div>
      <h1 class="main-title">
        <span th:text="${name}" class="user-name">ì‚¬ìš©ì</span>ë‹˜ì—ê²Œ<br>
        <strong>ì™„ë²½í•œ AI ì¹œêµ¬</strong>ë¥¼ ì°¾ì•˜ì–´ìš”!
      </h1>
    </div>

    <form method="post" id="aiForm" th:action="@{/member/custom-ai}">
      <!-- AI í”„ë¦¬ë·° ì¹´ë“œ -->
      <div class="ai-preview-card">
        <div class="ai-preview">
          <div class="circle">
            <img
                th:if="${ai.images != null and !#lists.isEmpty(ai.images)}"
                th:src="@{${ai.images[0].renamedName}}"
                th:alt="${ai.name + ' AI ì¸ë„¤ì¼'}"
            />
            <div th:unless="${ai.images != null and !#lists.isEmpty(ai.images)}"
                 class="ai-placeholder">
              <span class="ai-emoji">ğŸ¤–</span>
            </div>
          </div>

          <div class="ai-info">
            <div class="ai-name">
              <span th:text="${ai.name}">AI ì¹œêµ¬</span>
            </div>
            <p class="ai-desc">
              <span th:text="${name + 'ë‹˜, ' + ai.info}">ë‹¹ì‹ ì„ ìœ„í•œ íŠ¹ë³„í•œ AIì…ë‹ˆë‹¤.</span>
            </p>
          </div>
        </div>
      </div>

      <!-- Hidden inputs -->
      <input type="hidden" name="ai" th:value="${ai}" />
      <input type="hidden" name="aiId" th:value="${ai.aiId}" />
      <input type="hidden" name="name" th:value="${name}">

      <!-- ì•¡ì…˜ ë²„íŠ¼ë“¤ -->
      <div class="action-buttons">
        <button type="submit" class="start-btn" id="startBtn">
          <span class="btn-icon">ğŸš€</span>
          <span class="btn-text">ì‹œì‘í•˜ê¸°</span>
          <div class="btn-shine"></div>
        </button>

        <button type="button" class="check-other-btn" id="checkOtherBtn">
          <span class="btn-icon">ğŸ”</span>
          <span class="btn-text">ë‹¤ë¥¸ AIë„ í™•ì¸í•˜ê¸°</span>
        </button>
      </div>
    </form>
  </div>
</main>

<!-- ë¡œë”© ì˜¤ë²„ë ˆì´ -->
<div class="loading-overlay" id="loadingOverlay">
  <div class="loading-content">
    <div class="loading-spinner"></div>
    <h3>ì„¤ì •ì„ ì €ì¥í•˜ê³  ìˆì–´ìš”...</h3>
    <p>ì ì‹œë§Œ ê¸°ë‹¤ë ¤ì£¼ì„¸ìš”!</p>
  </div>
</div>

<script>
  // í˜ì´ì§€ ë¡œë“œ ì‹œ ì´ˆê¸°í™”
  document.addEventListener('DOMContentLoaded', function() {
    // ì½˜í…ì¸  ì¦‰ì‹œ í‘œì‹œ
    document.querySelector('.container').classList.add('show');

    // ë°°ê²½ ì¥ì‹ ìš”ì†Œë“¤ ì• ë‹ˆë©”ì´ì…˜
    const decorations = document.querySelectorAll('.bg-decoration');
    decorations.forEach((decoration, index) => {
      const randomDelay = Math.random() * 2;
      decoration.style.animationDelay = `${randomDelay}s`;
    });
  });

  // ë²„íŠ¼ í´ë¦­ íš¨ê³¼
  document.getElementById('startBtn').addEventListener('click', function(e) {
    this.classList.add('clicked');

    // ë¡œë”© í‘œì‹œ
    setTimeout(() => {
      document.getElementById('loadingOverlay').style.display = 'flex';
    }, 300);
  });

  // ë‹¤ë¥¸ AI í™•ì¸ ë²„íŠ¼
  document.getElementById('checkOtherBtn').addEventListener('click', function() {
    this.classList.add('clicked');

    const form = document.getElementById("aiForm");
    const formData = new FormData(form);

    // ë¡œë”© í‘œì‹œ
    document.getElementById('loadingOverlay').style.display = 'flex';

    fetch(form.action, {
      method: "POST",
      body: formData
    })
    .then(response => {
      if (response.ok) {
        setTimeout(() => {
          location.href = "/app/settings/ai";
        }, 800);
      } else {
        throw new Error('í¼ ì „ì†¡ ì‹¤íŒ¨');
      }
    })
    .catch(error => {
      console.error("ì˜¤ë¥˜ ë°œìƒ:", error);
      document.getElementById('loadingOverlay').style.display = 'none';

      // ì—ëŸ¬ ì•Œë¦¼ (ë” ë‚˜ì€ UIë¡œ ê°œì„  ê°€ëŠ¥)
      alert("ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤. ë‹¤ì‹œ ì‹œë„í•´ì£¼ì„¸ìš”.");

      this.classList.remove('clicked');
    });
  });

  // í‚¤ë³´ë“œ ì§€ì›
  document.addEventListener('keydown', function(e) {
    if (e.key === 'Enter' && !e.ctrlKey && !e.metaKey) {
      document.getElementById('startBtn').click();
    }
    if (e.key === ' ' && e.target === document.body) {
      e.preventDefault();
      document.getElementById('checkOtherBtn').click();
    }
  });
</script>
</body>
</html>